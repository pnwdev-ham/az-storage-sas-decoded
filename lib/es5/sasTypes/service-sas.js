"use strict";var __awaiter=this&&this.__awaiter||function(n,u,r,c){function o(e){return e instanceof r?e:new r(function(i){i(e)})}return new(r||(r=Promise))(function(e,i){function l(s){try{t(c.next(s))}catch(f){i(f)}}function a(s){try{t(c.throw(s))}catch(f){i(f)}}function t(s){s.done?e(s.value):o(s.value).then(l,a)}t((c=c.apply(n,u||[])).next())})},__generator=this&&this.__generator||function(n,u){var r={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},c,o,e,i;return i={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function l(t){return function(s){return a([t,s])}}function a(t){if(c)throw new TypeError("Generator is already executing.");for(;r;)try{if(c=1,o&&(e=t[0]&2?o.return:t[0]?o.throw||((e=o.return)&&e.call(o),0):o.next)&&!(e=e.call(o,t[1])).done)return e;switch(o=0,e&&(t=[t[0]&2,e.value]),t[0]){case 0:case 1:e=t;break;case 4:return r.label++,{value:t[1],done:!1};case 5:r.label++,o=t[1],t=[0];continue;case 7:t=r.ops.pop(),r.trys.pop();continue;default:if(e=r.trys,!(e=e.length>0&&e[e.length-1])&&(t[0]===6||t[0]===2)){r=0;continue}if(t[0]===3&&(!e||t[1]>e[0]&&t[1]<e[3])){r.label=t[1];break}if(t[0]===6&&r.label<e[1]){r.label=e[1],e=t;break}if(e&&r.label<e[2]){r.label=e[2],r.ops.push(t);break}e[2]&&r.ops.pop(),r.trys.pop();continue}t=u.call(n,r)}catch(s){t=[6,s],o=0}finally{c=e=0}if(t[0]&5)throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getServiceSasToken=exports.createServiceSasTokenFromOptions=void 0;var storage_blob_1=require("@azure/storage-blob");function createServiceSasTokenFromOptions(){return __awaiter(this,void 0,void 0,function(){var n,u;return __generator(this,function(r){return n={},u=getServiceSasToken(n.ResourceName,n.ResourceKey,n.ContainerName,n.ServiceSasPermissions,n.NowMinusMinutes,n.NowPlusMinutes,n.BlobName),[2]})})}exports.createServiceSasTokenFromOptions=createServiceSasTokenFromOptions;function getServiceSasToken(n,u,r,c,o,e,i){try{var l=new storage_blob_1.StorageSharedKeyCredential(n,u),a={containerName:r,permissions:void 0,protocol:storage_blob_1.SASProtocol.Https,startsOn:o,expiresOn:e};i?(a.blobName=i,a.permissions=storage_blob_1.BlobSASPermissions.parse(c),console.log("Scoped to blob named '".concat(i,"' permissions: ").concat(a.permissions,`
`))):(a.permissions=storage_blob_1.ContainerSASPermissions.parse(c),console.log("Scoped to container named '".concat(r,"' permissions: ").concat(a.permissions,`
`)));var t=(0,storage_blob_1.generateBlobSASQueryParameters)(a,l).toString();return i?"https://".concat(n,".blob.core.windows.net/").concat(r,"/").concat(i,"?").concat(t):"https://".concat(n,".blob.core.windows.net/").concat(r,"?").concat(t)}catch(s){console.log("generateBlobSASQueryParameters ".concat(s.message))}}exports.getServiceSasToken=getServiceSasToken;